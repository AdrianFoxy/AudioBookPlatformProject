<div class="container alternativ-angular-mats">
  <div class="row">
    <section class="col-9">
      <div class="d-flex justify-content-between align-items center pb-2 mt-2">
        <app-paging-header
          [totalCount]="totalCount"
          [pageNumber]="sortingAndPaginationParams.pageNumber"
          [pageSize]="sortingAndPaginationParams.pageSize"
        ></app-paging-header>
        <div class="d-flex mt-2">
          <input (keyup.enter)="onSearch()" type="text" placeholder="Search" class="form-control me-2" #search>
          <button (click)="onSearch()" class="search-btn btn btn-outline primary mx-2">Search</button>
        </div>
      </div>

      <div class="row row-cols-xl-5  row-cols-lg-4 row-cols-md-3 mt-2">
        <div class="col" *ngFor="let audiobook of audioBooks">
          <app-audiobook-item [audiobook]="audiobook"></app-audiobook-item>
        </div>
      </div>

      <div class="d-flex justify-content-center" *ngIf="totalCount > 0">
        <app-pager
          [totalCount]="totalCount"
          [pageSize]="sortingAndPaginationParams.pageSize"
          (pageChanged)="onPageChanged($event)"
        ></app-pager>
      </div>
    </section>
    <section class="col-3 mt-4">
      <p class="filtering-header">
        <span>Фільтри</span>
        <a class="reset-btn float-end" (click)="onReset()">
          Очистити
          <i class="fa fa-times" aria-hidden="true"></i>
        </a>
      </p>
      <div class="filters mt-2">

        <mat-form-field class="full-width">
          <mat-label>Сортування</mat-label>
          <mat-select (selectionChange)="onSortSelected($event)" [value]="sortOptions[0].value">
            <mat-option *ngFor="let sort of sortOptions" [value]="sort.value">{{ sort.name }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="full-width custom-form">
          <mat-label>Жанри</mat-label>
          <mat-select [formControl]="selectedIdGenres" multiple
            (selectionChange)="onFilterSelected(selectedIdGenres.value, 'genreIds')">
            <mat-select-trigger>
              <mat-chip-listbox>
                <mat-chip *ngFor="let genre of getByIds(selectedIdGenres.value, genres)" [removable]="true"
                  (removed)="onFilterRemoved(genre.id, selectedIdGenres)">
                  {{ genre.name }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-listbox>
            </mat-select-trigger>
            <mat-option>
              <ngx-mat-select-search [formControl]="searchCtrl" placeholderLabel="Пошук"></ngx-mat-select-search>
            </mat-option>
            <mat-option *ngFor="let genre of genres | filter: searchCtrl.value: 'name'" [value]="genre.id">
              {{ genre.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label>Автори</mat-label>
          <mat-select [formControl]="selectedIdAuthors" multiple
            (selectionChange)="onFilterSelected(selectedIdAuthors.value, 'authorIds')">
            <mat-select-trigger>
              <mat-chip-listbox>
                <mat-chip *ngFor="let author of getByIds(selectedIdAuthors.value, authors)" [removable]="true"
                  (removed)="onFilterRemoved(author.id, selectedIdAuthors)">
                  {{ author.name }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-listbox>
            </mat-select-trigger>
            <mat-option>
              <ngx-mat-select-search [formControl]="searchCtrl" placeholderLabel="Пошук"></ngx-mat-select-search>
            </mat-option>
            <mat-option *ngFor="let author of authors | filter: searchCtrl.value: 'name'" [value]="author.id">
              {{author.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label>Читає</mat-label>
          <mat-select [formControl]="selectedIdNarrators" multiple
            (selectionChange)="onFilterSelected(selectedIdNarrators.value, 'narratorIds')">
            <mat-select-trigger>
              <mat-chip-listbox>
                <mat-chip *ngFor="let narrator of getByIds(selectedIdNarrators.value, narrators)" [removable]="true"
                  (removed)="onFilterRemoved(narrator.id, selectedIdNarrators)">
                  {{ narrator.name }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-listbox>
            </mat-select-trigger>
            <mat-option>
              <ngx-mat-select-search [formControl]="searchCtrl" placeholderLabel="Пошук"></ngx-mat-select-search>
            </mat-option>
            <mat-option *ngFor="let narrator of narrators | filter: searchCtrl.value: 'name'" [value]="narrator.id">
              {{narrator.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label>Серія книг</mat-label>
          <mat-select [formControl]="selectedIdBookSeries" multiple
            (selectionChange)="onFilterSelected(selectedIdBookSeries.value, 'bookSeriresIds')">
            <mat-select-trigger>
              <mat-chip-listbox>
                <mat-chip *ngFor="let bookSerie of getByIds(selectedIdBookSeries.value, bookSeries)" [removable]="true"
                  (removed)="onFilterRemoved(bookSerie.id, selectedIdBookSeries)">
                  {{ bookSerie.name }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-listbox>
            </mat-select-trigger>
            <mat-option>
              <ngx-mat-select-search [formControl]="searchCtrl" placeholderLabel="Пошук"></ngx-mat-select-search>
            </mat-option>
            <mat-option *ngFor="let bookSerie of bookSeries | filter: searchCtrl.value: 'name'" [value]="bookSerie.id">
              {{bookSerie.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="full-width">
          <mat-label>Мова</mat-label>
          <mat-select [formControl]="selectedIdBookLanguages" multiple
            (selectionChange)="onFilterSelected(selectedIdBookLanguages.value, 'bookLanguageIds')">
            <mat-select-trigger>
              <mat-chip-listbox>
                <mat-chip *ngFor="let bookLanguage of getByIds(selectedIdBookLanguages.value, bookLanguages)"
                  [removable]="true"
                  (removed)="onFilterRemoved(bookLanguage.id, selectedIdBookLanguages)">
                  {{ bookLanguage.name }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-listbox>
            </mat-select-trigger>
            <mat-option>
              <ngx-mat-select-search [formControl]="searchCtrl" placeholderLabel="Пошук"></ngx-mat-select-search>
            </mat-option>
            <mat-option *ngFor="let bookLanguage of bookLanguages | filter: searchCtrl.value: 'name'"
              [value]="bookLanguage.id">
              {{bookLanguage.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <p class="filtering-label">Рейтинг</p>
        <mat-slider min="0" max="10" step="1" showTickMarks discrete [displayWith]="formatLabel">
          <input value="2" matSliderStartThumb>
          <input value="8" matSliderEndThumb>
        </mat-slider>

        <p class="filtering-label">Тривалість (години)</p>
        <mat-chip-listbox aria-label="Fish selection" multiple>
          <mat-chip-option>0-10</mat-chip-option>
          <mat-chip-option>10-20</mat-chip-option>
          <mat-chip-option color="accent" selected>20-30</mat-chip-option>
          <mat-chip-option color="warn">30-40</mat-chip-option>
          <mat-chip-option color="warn">40-50</mat-chip-option>
          <mat-chip-option color="warn">60-70</mat-chip-option>
          <mat-chip-option color="warn">70-80</mat-chip-option>
          <mat-chip-option color="warn">over 80 </mat-chip-option>
        </mat-chip-listbox>


        <p class="filtering-label mt-3">Винятки</p>
        <mat-form-field class="full-width">
          <mat-label>Select</mat-label>
          <mat-select>
            <mat-option value="one">First option</mat-option>
            <mat-option value="two">Second option</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

    </section>
  </div>
</div>
